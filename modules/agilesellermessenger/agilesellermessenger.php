<?php
///-build_id: 2019051707.2854
/// This source file is subject to the Software License Agreement that is bundled with this 
/// package in the file license.txt, or you can get it here
/// http://addons-modules.com/en/content/3-terms-and-conditions-of-use
///
/// @copyright  2009-2016 Addons-Modules.com
///  If you need open code to customize or merge code with othe modules, please contact us.
if (!defined('_PS_VERSION_'))
	exit;

class AgileSellerMessenger extends Module
{
	private $_postErrors = array();
	private	$_html = '';

	public function __construct()   {    $this->agile_configs = Configuration::getMultiple($this->getConfigKeys());      $this->agile_dependencies = array('agilemultipleseller' => '3.7.0.1', 'agilekernel'=>'1.7.1.1');     $this->agile_newfiles = array();      $this->name = 'agilesellermessenger';    $this->isAgileKernelCompatible = true;    $this->tab = 'front_office_features';    $this->bootstrap = true;    parent::__construct();      $this->version = '2.7.1.2';    $this->author = 'addons-modules.com';    $this->ps_versions_compliancy = array('min' => '1.7', 'max' => '1.8');    $this->dependencies = array('agilemultipleseller','agilekernel');      $this->displayName = $this->l('Agile Seller Messenger');    $this->description = $this->l('Provides a method of comunication among customers, sellers and store owner.');       }     private function getConfigKeys()  {   return array('ASMGER_LOGIN_REQUIRED','ASMGER_APPROVAL_REQUIRED','ASMGER_HIDE_EMAIL','ASMGER_EMAIL_COPYADMIN','ASMGER_USE_CAPCHA','ASMGER_ALLOW_ATTACHMENT','ASMGER_REMOVE_PHONE','ASMGER_REMOVE_EMAIL');  }    public function install()   {      if(!Module::isInstalled('agilekernel'))    {     $this->_errors[] = $this->l('You have to install Agile Kernel module before installing this module. The download link of this module should have been included your download email for your order. If you can not find it, please request by email to support@addons-modules.com with your order #.');     return false;    }      if(!$this->AgilePreinstall())return false;              if  (parent::install() == false )    {     $this->_errors[] = $this->l('Install error - call parent::install()');     return false;    }        AgileInstaller::add_field_ifnotexists('agile_sellermessage','attpsname1','varchar(256)','NULL');    AgileInstaller::add_field_ifnotexists('agile_sellermessage','attpsname2','varchar(256)','NULL');    AgileInstaller::add_field_ifnotexists('agile_sellermessage','attpsname3','varchar(256)','NULL');    AgileInstaller::add_field_ifnotexists('agile_sellermessage','attshname1','varchar(256)','NULL');          AgileInstaller::add_field_ifnotexists('agile_sellermessage','attshname2','varchar(256)','NULL');          AgileInstaller::add_field_ifnotexists('agile_sellermessage','attshname3','varchar(256)','NULL');          $R44B1740495C3DC5BAB56D0F3706FEA4F = intval(Configuration::get('AGILE_MS_PROFILE_ID'));    if(!AgileInstaller::create_tab('Seller Messenger','SellerMessengerParent','AgileModulesParent', $this->name))return false;    AgileInstaller::init_tab_prmission_for_existing_profiles('SellerMessengerParent',1,1,1,1);    AgileInstaller::update_access($R44B1740495C3DC5BAB56D0F3706FEA4F, 'SellerMessengerParent',1,0,0,0);      if(!AgileInstaller::create_tab("Customer Questions", "AdminSellerMessages",'SellerMessengerParent',$this->name))return false;    AgileInstaller::init_tab_prmission_for_existing_profiles('AdminSellerMessages',1,1,1,1);    AgileInstaller::update_access($R44B1740495C3DC5BAB56D0F3706FEA4F, 'AdminSellerMessages', 1,1,1,1);        if ($this->registerHook('displayHeader') == false      OR !$this->registerHook('displayRightColumnProduct')     OR $this->registerHook('displayProductExtraContent') == false     OR $this->AgileSetDefaultConfig('ASMGER_LOGIN_REQUIRED', 0) == false     OR $this->AgileSetDefaultConfig('ASMGER_APPROVAL_REQUIRED', 1) == false     OR $this->AgileSetDefaultConfig('ASMGER_HIDE_EMAIL', 1) == false     OR $this->AgileSetDefaultConfig('ASMGER_EMAIL_COPYADMIN', 0) == false     OR $this->AgileSetDefaultConfig('ASMGER_USE_CAPCHA', 1) == false     OR $this->AgileSetDefaultConfig('ASMGER_ALLOW_ATTACHMENT', 0) == false     OR $this->AgileSetDefaultConfig('ASMGER_REMOVE_PHONE', 1) == false     OR $this->AgileSetDefaultConfig('ASMGER_REMOVE_EMAIL', 1) == false    )return false;      Autoload::getInstance()->generateIndex();      return true;   }     public function uninstall()      {             if(!parent::uninstall())return false;            AgileInstaller::delete_tab("AdminSellerMessages");    AgileInstaller::delete_tab("SellerMessengerParent");            return true;      }     public function getContent()   {    $this->_html = '<h2>'.$this->displayName.'</h2>';        $R0E50532F705BA890C56DC90FC3472539 = AgileInstaller::detect_admin_folder($_SERVER['SCRIPT_FILENAME']);    $R5A0E1B3F4DE39462E7CECCA34A34D7E1 = AgileInstaller::install_health_check($this->agile_newfiles, $this->name, $R0E50532F705BA890C56DC90FC3472539);    if(!empty($R5A0E1B3F4DE39462E7CECCA34A34D7E1)) $this->_html .= $R5A0E1B3F4DE39462E7CECCA34A34D7E1;            $this->_html .= AgileInstaller::show_agile_links();    if (Tools::isSubmit('submitSettings'))    {     $R0F3195736DE0BDE1FC9487BEE957C598 = Tools::getValue('login_required');     if (intval($R0F3195736DE0BDE1FC9487BEE957C598) != 0)      $R0F3195736DE0BDE1FC9487BEE957C598 = 1;     Configuration::updateValue('ASMGER_LOGIN_REQUIRED', intval($R0F3195736DE0BDE1FC9487BEE957C598));       $R9BCDADDEF7DF5E2615B1A07BAD3D2D02 = Tools::getValue('approval_required');     if (intval($R9BCDADDEF7DF5E2615B1A07BAD3D2D02) != 0)      $R9BCDADDEF7DF5E2615B1A07BAD3D2D02 = 1;     Configuration::updateValue('ASMGER_APPROVAL_REQUIRED', intval($R9BCDADDEF7DF5E2615B1A07BAD3D2D02));       $REA328ABCD9DBE025C576B345EA4AED5C = Tools::getValue('hide_email');     if (intval($REA328ABCD9DBE025C576B345EA4AED5C) != 0)      $REA328ABCD9DBE025C576B345EA4AED5C = 1;     Configuration::updateValue('ASMGER_HIDE_EMAIL', intval($REA328ABCD9DBE025C576B345EA4AED5C));         $RF15E9B258D126242B775776A4BF99E53 = Tools::getValue('email_copyadmin');     if (intval($RF15E9B258D126242B775776A4BF99E53) != 0)      $RF15E9B258D126242B775776A4BF99E53 = 1;     Configuration::updateValue('ASMGER_EMAIL_COPYADMIN', intval($RF15E9B258D126242B775776A4BF99E53));       $RF0EB9E1FE9032C5A40773D958BD2AF96 = Tools::getValue('use_capcha');     if (intval($RF0EB9E1FE9032C5A40773D958BD2AF96) != 0)      $RF0EB9E1FE9032C5A40773D958BD2AF96 = 1;     Configuration::updateValue('ASMGER_USE_CAPCHA', intval($RF0EB9E1FE9032C5A40773D958BD2AF96));       $R0FD9C34EADE561743514C50D03805C69 = Tools::getValue('allow_attachment');     if (intval($R0FD9C34EADE561743514C50D03805C69) != 0)      $R0FD9C34EADE561743514C50D03805C69 = 1;     Configuration::updateValue('ASMGER_ALLOW_ATTACHMENT', intval($R0FD9C34EADE561743514C50D03805C69));       Configuration::updateValue('ASMGER_REMOVE_PHONE', (int)Tools::getValue('remove_phone'));     Configuration::updateValue('ASMGER_REMOVE_EMAIL', (int)Tools::getValue('remove_email'));       $this->_html .= $this->displayConfirmation($this->l('Settings updated'));    }      $this->displayForm();      return $this->_html;   }     public function displayForm()   {       $R0F3195736DE0BDE1FC9487BEE957C598 = intval(Configuration::get('ASMGER_LOGIN_REQUIRED'));       $R9BCDADDEF7DF5E2615B1A07BAD3D2D02 = intval(Configuration::get('ASMGER_APPROVAL_REQUIRED'));       $RF15E9B258D126242B775776A4BF99E53 = intval(Configuration::get('ASMGER_EMAIL_COPYADMIN'));       $RF0EB9E1FE9032C5A40773D958BD2AF96 = intval(Configuration::get('ASMGER_USE_CAPCHA'));       $REA328ABCD9DBE025C576B345EA4AED5C = intval(Configuration::get('ASMGER_HIDE_EMAIL'));    $R0FD9C34EADE561743514C50D03805C69 =  intval(Configuration::get('ASMGER_ALLOW_ATTACHMENT'));    $R6C5D9317BC9F368659DAE15BC202F697 =  intval(Configuration::get('ASMGER_REMOVE_PHONE'));    $R1D79C4CAF31E052C0AAADEB912DF9678 =  intval(Configuration::get('ASMGER_REMOVE_EMAIL'));      $RD05A28496998D5D330106BBAE629B948 = array(     'form' => array(      'legend' => array(       'title' => $this->l('Settings'),       'image' => $this->_path.'logo.png',      ),      'input' => array(       array(        'type' => 'radio',        'label' => $this->l('Log in Required'),        'name' => 'login_required',        'values' => array(         array(          'id' => 'login_required_on',          'value' => 1,          'label' => $this->l('Yes')         ),         array(          'id' => 'login_required_off',          'value' => 0,          'label' => $this->l('No'),         ),        ),        'desc' => $this->l('Is customer required to log in to ask seller a question?')       ),       array(        'type' => 'radio',        'label' => $this->l('Message Approval Required'),        'name' => 'approval_required',        'values' => array(         array(          'id' => 'approval_required_on',          'value' => 1,          'label' => $this->l('Yes')         ),         array(          'id' => 'approval_required_off',          'value' => 0,          'label' => $this->l('No'),         ),        ),        'desc' => $this->l('Does customer message need to be approved by seller or admin before it appears at front store product page?')       ),       array(        'type' => 'agile_condition_radio',        'label' => $this->l('Hide email address'),        'name' => 'hide_email',        'onchange' => 'onhideemailchange()',        'values' => array(         array(          'id' => 'hide_email_on',          'value' => 1,          'label' => $this->l('Yes')         ),         array(          'id' => 'hide_email_off',          'value' => 0,          'label' => $this->l('No'),         ),        ),        'desc' => $this->l('Hide seller/customer email addresses from each other?')       ),       array(        'type' => 'radio',        'label' => $this->l('Copy email to admin'),        'name' => 'email_copyadmin',        'values' => array(         array(          'id' => 'email_copyadmin_on',          'value' => 1,          'label' => $this->l('Yes')         ),         array(          'id' => 'email_copyadmin_off',          'value' => 0,          'label' => $this->l('No'),         ),        ),        'desc' => $this->l('Copy all customer messages (emails) to store admin when sent to seller?')       ),       array(        'type' => 'radio',        'label' => $this->l('Use Capcha'),        'name' => 'use_capcha',        'values' => array(         array(          'id' => 'use_capcha_on',          'value' => 1,          'label' => $this->l('Yes')         ),         array(          'id' => 'use_capcha_off',          'value' => 0,          'label' => $this->l('No'),         ),        ),        'desc' => $this->l('Use capcha to avoid spam message if user is not logged?')       ),       array(        'type' => 'radio',        'label' => $this->l('Allow Attachment'),        'name' => 'allow_attachment',        'values' => array(         array(          'id' => 'allow_attachment_on',          'value' => 1,          'label' => $this->l('Yes')         ),         array(          'id' => 'allow_attachment_off',          'value' => 0,          'label' => $this->l('No'),         ),        ),        'desc' => $this->l('Allow attachment in customer messages and seller reply messages?')       ),             array(        'type' => 'radio',        'label' => $this->l('Remove phone from message'),        'name' => 'remove_phone',        'values' => array(         array(          'id' => 'remove_phone_on',          'value' => 1,          'label' => $this->l('Yes')         ),         array(          'id' => 'remove_phone_off',          'value' => 0,          'label' => $this->l('No'),         ),        ),        'desc' => $this->l('Remove phone numbers from message that send to seller or customer')       ),             array(        'type' => 'radio',        'label' => $this->l('Remove email address from message'),        'name' => 'remove_email',        'values' => array(         array(          'id' => 'remove_email_on',          'value' => 1,          'label' => $this->l('Yes')         ),         array(          'id' => 'remove_email_off',          'value' => 0,          'label' => $this->l('No'),         ),        ),        'desc' => $this->l('Remove email address from message that send to seller or customer')       ),            ),      'submit' => array(       'title' => $this->l('Save'),      )     )    );      $R3A1E73211A105E82A8C89F8C8E3C8264 = new HelperForm();    $R3A1E73211A105E82A8C89F8C8E3C8264->show_toolbar = false;    $R3A1E73211A105E82A8C89F8C8E3C8264->table =  $this->name;    $R51C716B9664B3F4E109066C05B9B1A86 = new Language((int)Configuration::get('PS_LANG_DEFAULT'));    $R3A1E73211A105E82A8C89F8C8E3C8264->default_form_language = $R51C716B9664B3F4E109066C05B9B1A86->id;    $R3A1E73211A105E82A8C89F8C8E3C8264->module = $this;    $R3A1E73211A105E82A8C89F8C8E3C8264->allow_employee_form_lang = Configuration::get('PS_BO_ALLOW_EMPLOYEE_FORM_LANG') ? Configuration::get('PS_BO_ALLOW_EMPLOYEE_FORM_LANG') : 0;    $R3A1E73211A105E82A8C89F8C8E3C8264->identifier = $this->identifier;    $R3A1E73211A105E82A8C89F8C8E3C8264->submit_action = 'submitSettings';    $R3A1E73211A105E82A8C89F8C8E3C8264->currentIndex = $this->context->link->getAdminLink('AdminModules', false).'&configure='.$this->name.'&tab_module='.$this->tab.'&module_name='.$this->name;    $R3A1E73211A105E82A8C89F8C8E3C8264->token = Tools::getAdminTokenLite('AdminModules');    $R3A1E73211A105E82A8C89F8C8E3C8264->tpl_vars = array(     'fields_value' => $this->getConfigFieldsValues(),     'languages' => $this->context->controller->getLanguages(),     'id_language' => $this->context->language->id    );      $this->_html .=  $R3A1E73211A105E82A8C89F8C8E3C8264->generateForm(array($RD05A28496998D5D330106BBAE629B948));     }     public function getConfigFieldsValues()   {    $RAD18A3B70BBA0E07328F61AA60763FD4 = $this->getConfigKeys();    $RBAAA917A11E347C49C3462A9383AE5BD = Configuration::getMultiple($RAD18A3B70BBA0E07328F61AA60763FD4);      return array(     'login_required' => Tools::getValue('login_required', array_key_exists('ASMGER_LOGIN_REQUIRED', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASMGER_LOGIN_REQUIRED'] : ''),     'approval_required' => Tools::getValue('approval_required', array_key_exists('ASMGER_APPROVAL_REQUIRED', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASMGER_APPROVAL_REQUIRED'] : ''),     'hide_email' => Tools::getValue('hide_email', array_key_exists('ASMGER_HIDE_EMAIL', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASMGER_HIDE_EMAIL'] : ''),     'email_copyadmin' => Tools::getValue('email_copyadmin', array_key_exists('ASMGER_EMAIL_COPYADMIN', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASMGER_EMAIL_COPYADMIN'] : ''),     'use_capcha' => Tools::getValue('use_capcha', array_key_exists('ASMGER_USE_CAPCHA', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASMGER_USE_CAPCHA'] : ''),     'allow_attachment' => Tools::getValue('allow_attachment', array_key_exists('ASMGER_ALLOW_ATTACHMENT', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASMGER_ALLOW_ATTACHMENT'] : ''),     'remove_phone' => Tools::getValue('remove_phone', array_key_exists('ASMGER_REMOVE_PHONE', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASMGER_REMOVE_PHONE'] : ''),     'remove_email' => Tools::getValue('remove_email', array_key_exists('ASMGER_REMOVE_EMAIL', $RBAAA917A11E347C49C3462A9383AE5BD) ? $RBAAA917A11E347C49C3462A9383AE5BD['ASMGER_REMOVE_EMAIL'] : ''),     );   }   public function hookDisplayHeader($RC2D2567438B1F39DD71F78195B5F3DED)   {    if (session_status() == PHP_SESSION_NONE)@session_start();    if($this->context->controller->php_self == "product")    {     $this->context->controller->registerJavascript('asm-sellerquestionform-js','/modules/agilesellermessenger/js/sellerquestionform.js',['position' => 'bottom', 'priority' => 100]);    }   }       public function hookDisplayProductExtraContent($RC2D2567438B1F39DD71F78195B5F3DED)   {    $R5E74CE6461E75BAAAF20290224125798 = array();    if(!$this->active)return $R5E74CE6461E75BAAAF20290224125798;      require_once(_PS_ROOT_DIR_ .'/modules/agilemultipleseller/SellerInfo.php');    require_once(_PS_ROOT_DIR_ .'/modules/agilesellermessenger/AgileSellerMessage.php');        $this->context->smarty->assign('postSellerQuestionSuccess','');    if (Tools::isSubmit('submitSellerQuestion'))    {     $this->postSellerQuestionProcess();     if(empty($this->_postErrors))      $this->context->smarty->assign('postSellerQuestionSuccess', $this->l('Your message has been received successfully. The seller of the product will reply shortly.'));           }         $R98F71C90270F6307B83D739AE81540AC = $_SERVER['REQUEST_URI'];      $R980C6A9BFD38E36311B691E3ADD7CCAD = strpos($R98F71C90270F6307B83D739AE81540AC, "?");    if($R980C6A9BFD38E36311B691E3ADD7CCAD >0)$R98F71C90270F6307B83D739AE81540AC = substr($R98F71C90270F6307B83D739AE81540AC,0,$R980C6A9BFD38E36311B691E3ADD7CCAD);    if(strpos($R98F71C90270F6307B83D739AE81540AC,".php")>0)    {     $R98F71C90270F6307B83D739AE81540AC .= "?id_product=" . Tools::getValue('id_product');     }    else     $R98F71C90270F6307B83D739AE81540AC = $R98F71C90270F6307B83D739AE81540AC . "?";            $R40095968F29813E02A981F327827F17B = intval(Tools::getValue('id_product'));    $RB3F07F8C3658A835940E88288B58F707 = new Product($R40095968F29813E02A981F327827F17B, false, $this->context->cookie->id_lang);    $R95909C49377A2B4F24C79D29C629AF65 = AgileSellerManager::getObjectOwnerID('product',$R40095968F29813E02A981F327827F17B);    $R17AC9BFA1ABB066C772CEAE0B3CD86E9 = new Employee($R95909C49377A2B4F24C79D29C629AF65);    $R3F76C20596A009928F756B651F405812 = new SellerInfo(SellerInfo::getIdBSellerId($R95909C49377A2B4F24C79D29C629AF65), $this->context->cookie->id_lang);    $R4117BD9C2FBBD57A0591E55A5204FD0B = new Customer($this->context->cookie->id_customer);      $R868CEDE9DF5E77E37B10446B8397B575 = AgileSellerMessage::getSellerMessages($R95909C49377A2B4F24C79D29C629AF65, $R40095968F29813E02A981F327827F17B,1, true);    $R08BD2B0ECD475D249F1692D4B85CDEFC = intval(Tools::getValue('p'));    $RA4F29B247E8BB0D668BE6CDD6871289C = intval(Tools::getValue('n'));    $R8DC041438F1653B50A01EF7BD43CDDB4 = AgileSellerMessage::getSellerMessages($R95909C49377A2B4F24C79D29C629AF65, $R40095968F29813E02A981F327827F17B, 1, false,$R08BD2B0ECD475D249F1692D4B85CDEFC==0?1:$R08BD2B0ECD475D249F1692D4B85CDEFC, $RA4F29B247E8BB0D668BE6CDD6871289C==0?10:$RA4F29B247E8BB0D668BE6CDD6871289C);            $R9E36C53D34691939AB09D34C573B3D60 = (Validate::isLoadedObject($R4117BD9C2FBBD57A0591E55A5204FD0B)?($R4117BD9C2FBBD57A0591E55A5204FD0B->firstname . ' ' . $R4117BD9C2FBBD57A0591E55A5204FD0B->lastname) : Tools::getValue('customer_name'));    $R786C41E78FFEC4D859D98DE76DC8A3C1 = (Validate::isLoadedObject($R4117BD9C2FBBD57A0591E55A5204FD0B)?$R4117BD9C2FBBD57A0591E55A5204FD0B->email : Tools::getValue('customer_email'));    $this->context->smarty->assign(array(     'sellerinfo' => $R3F76C20596A009928F756B651F405812     ,'sellerquestions_nb' => $R868CEDE9DF5E77E37B10446B8397B575     ,'login_required_sellerquestion' => intval(Configuration::get('ASMGER_LOGIN_REQUIRED'))     ,'use_capcha_sellerquestion' => intval(Configuration::get('ASMGER_USE_CAPCHA'))     ,'sellerquestions' => $R8DC041438F1653B50A01EF7BD43CDDB4     ,'request_sellerquestion_uri' => $R98F71C90270F6307B83D739AE81540AC     ,'customer_name' => $R9E36C53D34691939AB09D34C573B3D60     ,'customer_email' => $R786C41E78FFEC4D859D98DE76DC8A3C1      ,'id_product' => $R40095968F29813E02A981F327827F17B     ,'product_name' => $RB3F07F8C3658A835940E88288B58F707->name     ,'post_message' => Tools::getValue('customer_message')     ,'post_errors' =>$this->_postErrors     ,'allow_attachment' => intval(Configuration::get('ASMGER_ALLOW_ATTACHMENT'))     ,'ispostbacksellerquestion' => Tools::getValue('ispostbacksellerquestion')     ,'request_sellerquestion_p' => ($R08BD2B0ECD475D249F1692D4B85CDEFC ==0?1:$R08BD2B0ECD475D249F1692D4B85CDEFC)     ,'request_sellerquestion_n' => ($RA4F29B247E8BB0D668BE6CDD6871289C ==0?10:$RA4F29B247E8BB0D668BE6CDD6871289C)     ,'logged' => $this->context->customer->isLogged()     ));      $RE82EE9B121F709895EF54EBA7FA6B78B = $this->display(__FILE__, '/views/templates/hook/hookdisplayextracontent.tpl');    $R5E74CE6461E75BAAAF20290224125798[] = (new PrestaShop\PrestaShop\Core\Product\ProductExtraContent())    ->setTitle($this->l('Seller Q/A'))    ->setContent($RE82EE9B121F709895EF54EBA7FA6B78B);      return $R5E74CE6461E75BAAAF20290224125798;   }           public function hookDisplayRightColumnProduct($RC2D2567438B1F39DD71F78195B5F3DED)      {    if(!$this->active)return;      return $this->display(__FILE__, 'views/templates/hook/hookextraright.tpl');          }             private function postSellerQuestionProcess()     {    if(!$this->active)return;      if (!Tools::isSubmit('submitSellerQuestion'))return;      $R0764ED9059A414C8765B753293B9D358 = NULL;      if (isset($_FILES['fileUpload1']['name']) AND !empty($_FILES['fileUpload1']['name']) AND !empty($_FILES['fileUpload1']['tmp_name']))    {     $R3227A1335DA8F57625636F5E85474A1A = uniqid().substr($_FILES['fileUpload1']['name'], -5);    }    if (isset($_FILES['fileUpload2']['name']) AND !empty($_FILES['fileUpload2']['name']) AND !empty($_FILES['fileUpload2']['tmp_name']))    {     $RDA5A5C4F5E32B6177B2AD94A14775690 = uniqid().substr($_FILES['fileUpload2']['name'], -5);    }    if (isset($_FILES['fileUpload3']['name']) AND !empty($_FILES['fileUpload3']['name']) AND !empty($_FILES['fileUpload3']['tmp_name']))    {     $RC545D2EFE437137D2EFEA1053BD903CE = uniqid().substr($_FILES['fileUpload3']['name'], -5);    }            $R40095968F29813E02A981F327827F17B = intval(Tools::getValue('id_product'));    $RB3F07F8C3658A835940E88288B58F707 = new Product($R40095968F29813E02A981F327827F17B, false, $this->context->cookie->id_lang);          $R95909C49377A2B4F24C79D29C629AF65 = AgileSellerManager::getObjectOwnerID('product',$R40095968F29813E02A981F327827F17B);    $R17AC9BFA1ABB066C772CEAE0B3CD86E9 = new Employee($R95909C49377A2B4F24C79D29C629AF65 > 0 ? $R95909C49377A2B4F24C79D29C629AF65 : 1);    if(!Validate::isLoadedObject($R17AC9BFA1ABB066C772CEAE0B3CD86E9))retuen;      $R157A6826A8BF1F36EBBE3DEC02351744 = new AgileSellerMessage();    $R157A6826A8BF1F36EBBE3DEC02351744->id_seller = AgileSellerManager::getObjectOwnerID('product',intval(Tools::getValue('id_product')));;    $R157A6826A8BF1F36EBBE3DEC02351744->id_product = intval(Tools::getValue('id_product'));    $R157A6826A8BF1F36EBBE3DEC02351744->id_customer = $this->context->cookie->id_customer;    $R157A6826A8BF1F36EBBE3DEC02351744->id_order=0;       $R157A6826A8BF1F36EBBE3DEC02351744->is_customer_message = 1;       if(intval(Configuration::get('ASMGER_APPROVAL_REQUIRED')))           $R157A6826A8BF1F36EBBE3DEC02351744->active = 0;          else           $R157A6826A8BF1F36EBBE3DEC02351744->active = 1;      $R157A6826A8BF1F36EBBE3DEC02351744->id_lang = $this->context->cookie->id_lang;    $R157A6826A8BF1F36EBBE3DEC02351744->ip_address = $_SERVER['REMOTE_ADDR'];    $R157A6826A8BF1F36EBBE3DEC02351744->from_email = Tools::getValue('customer_email');    $R157A6826A8BF1F36EBBE3DEC02351744->from_name = Tools::getValue('customer_name');    $R157A6826A8BF1F36EBBE3DEC02351744->subject = $this->get_message_subject($RB3F07F8C3658A835940E88288B58F707);    $R157A6826A8BF1F36EBBE3DEC02351744->message = strip_tags(Tools::getValue('customer_message'));              if(AgileSellerMessage::hasSamePost($R157A6826A8BF1F36EBBE3DEC02351744->from_name, $R157A6826A8BF1F36EBBE3DEC02351744->ip_address, $R157A6826A8BF1F36EBBE3DEC02351744->message,$R157A6826A8BF1F36EBBE3DEC02351744->id_product))              $this->_postErrors[] = $this->l('You can not post the same question within this time interval');                    if(Configuration::get('ASMGER_USE_CAPCHA') AND !AgileHelper::ValidateRecapcha())     $this->_postErrors[] = $this->l('Please check the security verification form');      if (!$R157A6826A8BF1F36EBBE3DEC02351744->message)     $this->_postErrors[] = $this->l('Question content is required.');       if (!Tools::getValue('customer_name'))     $this->_postErrors[] = $this->l('Your name is required.');      $R3435986BDA8C9393E0EBDB9F58F02750 = self::prepareAttFolder(intval($R95909C49377A2B4F24C79D29C629AF65));    if (isset($R3227A1335DA8F57625636F5E85474A1A) AND rename($_FILES['fileUpload1']['tmp_name'], $R3435986BDA8C9393E0EBDB9F58F02750.$R3227A1335DA8F57625636F5E85474A1A))    {      $R5E49E434B525FE69B9A52B79E846320F = basename($_FILES['fileUpload1']['name']);     $R157A6826A8BF1F36EBBE3DEC02351744->attshname1 = $R5E49E434B525FE69B9A52B79E846320F;     $R157A6826A8BF1F36EBBE3DEC02351744->attpsname1 = $R3227A1335DA8F57625636F5E85474A1A;    }    if (isset($RDA5A5C4F5E32B6177B2AD94A14775690) AND rename($_FILES['fileUpload2']['tmp_name'], $R3435986BDA8C9393E0EBDB9F58F02750.$RDA5A5C4F5E32B6177B2AD94A14775690))    {     $R5E49E434B525FE69B9A52B79E846320F = basename($_FILES['fileUpload2']['name']);     $R157A6826A8BF1F36EBBE3DEC02351744->attshname2 = $R5E49E434B525FE69B9A52B79E846320F;     $R157A6826A8BF1F36EBBE3DEC02351744->attpsname2 = $RDA5A5C4F5E32B6177B2AD94A14775690;    }    if (isset($RC545D2EFE437137D2EFEA1053BD903CE) AND rename($_FILES['fileUpload3']['tmp_name'], $R3435986BDA8C9393E0EBDB9F58F02750.$RC545D2EFE437137D2EFEA1053BD903CE))    {       $R5E49E434B525FE69B9A52B79E846320F = basename($_FILES['fileUpload3']['name']);     $R157A6826A8BF1F36EBBE3DEC02351744->attshname3 = $R5E49E434B525FE69B9A52B79E846320F;     $R157A6826A8BF1F36EBBE3DEC02351744->attpsname3 = $RC545D2EFE437137D2EFEA1053BD903CE;    }                    if(!empty($this->_postErrors))return;    $R157A6826A8BF1F36EBBE3DEC02351744->save();             $REA328ABCD9DBE025C576B345EA4AED5C = intval(Configuration::get('ASMGER_HIDE_EMAIL'));    $R996A912949D42940B4C679CD4A1A2A73 = Configuration::get('PS_SHOP_EMAIL');       if($REA328ABCD9DBE025C576B345EA4AED5C)           $R39A530506329CA296814791255B22F17 = NULL;       else           $R39A530506329CA296814791255B22F17 = $R157A6826A8BF1F36EBBE3DEC02351744->from_email;      $RB3F07F8C3658A835940E88288B58F707 = new Product($R157A6826A8BF1F36EBBE3DEC02351744->id_product,false,$this->context->cookie->id_lang);      $RD867D30AF2115120F58AD21C9B2F3E22 =  $this->get_message_subject($RB3F07F8C3658A835940E88288B58F707);        $RDD95BBEC198B2C577F5B3E60A5984492 = $R157A6826A8BF1F36EBBE3DEC02351744->message;    if((int)Configuration::get('ASMGER_REMOVE_PHONE'))$RDD95BBEC198B2C577F5B3E60A5984492 = AgileHelper::remove_phone($RDD95BBEC198B2C577F5B3E60A5984492);    if((int)Configuration::get('ASMGER_REMOVE_EMAIL'))$RDD95BBEC198B2C577F5B3E60A5984492 = AgileHelper::remove_email($RDD95BBEC198B2C577F5B3E60A5984492);          $R4180B2D55D2131557A27FB8F2D858A4F = 'mtoseller';    $RBDB2AD8B968947A80C82ED09BD702976 = array(      '{from_email}' => $R996A912949D42940B4C679CD4A1A2A73,      '{customer_name}' => $R157A6826A8BF1F36EBBE3DEC02351744->from_name,      '{customer_email}' => Tools::getValue('customer_email'),      '{shop_name}' => Configuration::get('PS_SHOP_NAME'),      '{shop_url}' => Tools::getShopDomainSsl(true,true).__PS_BASE_URI__,      '{product_name}' => $RB3F07F8C3658A835940E88288B58F707->name,      '{product_link}' => $this->context->link->getProductLink($R157A6826A8BF1F36EBBE3DEC02351744->id_product),      '{message}' => $RDD95BBEC198B2C577F5B3E60A5984492    );         $R843772E13ECF32C5CEEF23010FB27FBA = $this->context->cookie->id_lang;    $RDECEF4CB355A93715801928439CC147C = Language::getIsoById((int)($R843772E13ECF32C5CEEF23010FB27FBA));    if (file_exists(dirname(__FILE__).'/mails/'.$RDECEF4CB355A93715801928439CC147C.'/'.$R4180B2D55D2131557A27FB8F2D858A4F.'.txt') AND file_exists(dirname(__FILE__).'/mails/'.$RDECEF4CB355A93715801928439CC147C.'/'.$R4180B2D55D2131557A27FB8F2D858A4F.'.html'))     Mail::Send($R843772E13ECF32C5CEEF23010FB27FBA, $R4180B2D55D2131557A27FB8F2D858A4F, $RD867D30AF2115120F58AD21C9B2F3E22, $RBDB2AD8B968947A80C82ED09BD702976, $R17AC9BFA1ABB066C772CEAE0B3CD86E9->email, NULL, $R996A912949D42940B4C679CD4A1A2A73, $R157A6826A8BF1F36EBBE3DEC02351744->from_name, NULL, NULL, dirname(__FILE__).'/mails/', false, NULL,NULL,$R39A530506329CA296814791255B22F17);        if(intval(Configuration::get('ASMGER_EMAIL_COPYADMIN'))>0)    {     if (file_exists(dirname(__FILE__).'/mails/'.$RDECEF4CB355A93715801928439CC147C.'/'.$R4180B2D55D2131557A27FB8F2D858A4F.'.txt') AND file_exists(dirname(__FILE__).'/mails/'.$RDECEF4CB355A93715801928439CC147C.'/'.$R4180B2D55D2131557A27FB8F2D858A4F.'.html'))      Mail::Send($R843772E13ECF32C5CEEF23010FB27FBA, $R4180B2D55D2131557A27FB8F2D858A4F, $RD867D30AF2115120F58AD21C9B2F3E22, $RBDB2AD8B968947A80C82ED09BD702976, $R996A912949D42940B4C679CD4A1A2A73, NULL, $R996A912949D42940B4C679CD4A1A2A73, NULL, NULL, NULL, dirname(__FILE__).'/mails/', false, NULL,NULL,$R39A530506329CA296814791255B22F17);    }         }           public static function prepareAttFolder($R95909C49377A2B4F24C79D29C629AF65)   {       $R3435986BDA8C9393E0EBDB9F58F02750 = _PS_IMG_DIR_ . 'att/';       if(!file_exists($R3435986BDA8C9393E0EBDB9F58F02750))mkdir($R3435986BDA8C9393E0EBDB9F58F02750);       $R3435986BDA8C9393E0EBDB9F58F02750 = $R3435986BDA8C9393E0EBDB9F58F02750 . $R95909C49377A2B4F24C79D29C629AF65 . '/';    if(!file_exists($R3435986BDA8C9393E0EBDB9F58F02750))mkdir($R3435986BDA8C9393E0EBDB9F58F02750);    return $R3435986BDA8C9393E0EBDB9F58F02750;   }       private function get_message_subject($RB3F07F8C3658A835940E88288B58F707)     {    $R67BE2B4F527EE4BAF4CB44E1383CAA7B = $this->l('Inquiry on product -');    if($RB3F07F8C3658A835940E88288B58F707->name)$R67BE2B4F527EE4BAF4CB44E1383CAA7B = $R67BE2B4F527EE4BAF4CB44E1383CAA7B . $RB3F07F8C3658A835940E88288B58F707->name;    return $R67BE2B4F527EE4BAF4CB44E1383CAA7B;     }                      public static function sendSellerReply($RC65F619E754A271D3A55F38143E6BF03)      {    $RB10E8575D7A5B4C417D9DCF8D6BC17BE = Context::getContext();              include_once(_PS_ROOT_DIR_ . "/modules/agilemultipleseller/SellerInfo.php");          $RA82B8E922943C74082F982E24398CA04 = array();          $R6F82286AF8E7368B69D53D2BFC9EECFA = Tools::getValue('reply_message');          if(empty($R6F82286AF8E7368B69D53D2BFC9EECFA))          {              $RA82B8E922943C74082F982E24398CA04[] = $this->l('Reply message cannot be empty.');              return;          }          $R2065A4598F5AC52A855CD972A4D582B5 = new AgileSellerMessage(Tools::getValue('id_agile_sellermessage'));          $R95909C49377A2B4F24C79D29C629AF65 = intval($R2065A4598F5AC52A855CD972A4D582B5->id_seller);          if($R95909C49377A2B4F24C79D29C629AF65 >0)          {     $R3F76C20596A009928F756B651F405812 = new SellerInfo(SellerInfo::getIdBSellerId($R95909C49377A2B4F24C79D29C629AF65), $RB10E8575D7A5B4C417D9DCF8D6BC17BE->cookie->id_lang);              $R949BE5B433DF94FCB11558CCC5A7A325 = new Customer($R3F76C20596A009928F756B651F405812->id_customer);              $R224ED324F2BC1D54C39C9EA8DBC1FDCE = $R949BE5B433DF94FCB11558CCC5A7A325->email;              $RB1F893EC40EFE964D900B41AF7FCC4AB = $R3F76C20596A009928F756B651F405812->company;          }          else          {              $RB1F893EC40EFE964D900B41AF7FCC4AB = Configuration::get('PS_SHOP_NAME');              $R224ED324F2BC1D54C39C9EA8DBC1FDCE = Configuration::get('PS_SHOP_EMAIL');          }               $REA328ABCD9DBE025C576B345EA4AED5C = intval(Configuration::get('ASMGER_HIDE_EMAIL'));          if($REA328ABCD9DBE025C576B345EA4AED5C)           $R996A912949D42940B4C679CD4A1A2A73 = NULL;          else           $R996A912949D42940B4C679CD4A1A2A73 = $R224ED324F2BC1D54C39C9EA8DBC1FDCE;                                                              $R6F82286AF8E7368B69D53D2BFC9EECFA .= "\n";                    $R3870A31671674F38BD563DC916D3A5A0 = explode("\n", $R2065A4598F5AC52A855CD972A4D582B5->message);          foreach($R3870A31671674F38BD563DC916D3A5A0 AS $R9061C9FEF16E7C8C556365E17D37952C)          {              $R6F82286AF8E7368B69D53D2BFC9EECFA .= ">" . $R9061C9FEF16E7C8C556365E17D37952C . "\n";          }                 if((int)Configuration::get('ASMGER_REMOVE_PHONE'))$R6F82286AF8E7368B69D53D2BFC9EECFA = AgileHelper::remove_phone($R6F82286AF8E7368B69D53D2BFC9EECFA);    if((int)Configuration::get('ASMGER_REMOVE_EMAIL'))$R6F82286AF8E7368B69D53D2BFC9EECFA = AgileHelper::remove_email($R6F82286AF8E7368B69D53D2BFC9EECFA);            $R4180B2D55D2131557A27FB8F2D858A4F = 'mtocustomer';          $RBDB2AD8B968947A80C82ED09BD702976 = array(            '{seller_name}' => $RB1F893EC40EFE964D900B41AF7FCC4AB,            '{shop_name}' => Configuration::get('PS_SHOP_NAME'),            '{shop_url}' => Tools::getShopDomainSsl(true,true).__PS_BASE_URI__,            '{message}' => str_replace("\n","<br />", $R6F82286AF8E7368B69D53D2BFC9EECFA)          );               $R843772E13ECF32C5CEEF23010FB27FBA = $RB10E8575D7A5B4C417D9DCF8D6BC17BE->cookie->id_lang;          $RD867D30AF2115120F58AD21C9B2F3E22 = $R2065A4598F5AC52A855CD972A4D582B5->subject;          $RDECEF4CB355A93715801928439CC147C = Language::getIsoById((int)($R843772E13ECF32C5CEEF23010FB27FBA));          if (file_exists(dirname(__FILE__).'/mails/'.$RDECEF4CB355A93715801928439CC147C.'/'.$R4180B2D55D2131557A27FB8F2D858A4F.'.txt') AND file_exists(dirname(__FILE__).'/mails/'.$RDECEF4CB355A93715801928439CC147C.'/'.$R4180B2D55D2131557A27FB8F2D858A4F.'.html'))          {           Mail::Send($R843772E13ECF32C5CEEF23010FB27FBA, $R4180B2D55D2131557A27FB8F2D858A4F, $RD867D30AF2115120F58AD21C9B2F3E22, $RBDB2AD8B968947A80C82ED09BD702976, $R2065A4598F5AC52A855CD972A4D582B5->from_email, NULL, $R996A912949D42940B4C679CD4A1A2A73, $RB1F893EC40EFE964D900B41AF7FCC4AB, NULL, NULL, dirname(__FILE__).'/mails/');       if(intval(Configuration::get('ASMGER_EMAIL_COPYADMIN'))>0)            Mail::Send($R843772E13ECF32C5CEEF23010FB27FBA, $R4180B2D55D2131557A27FB8F2D858A4F, $RD867D30AF2115120F58AD21C9B2F3E22, $RBDB2AD8B968947A80C82ED09BD702976, Configuration::get('PS_SHOP_EMAIL'), NULL, $R996A912949D42940B4C679CD4A1A2A73, $RB1F893EC40EFE964D900B41AF7FCC4AB, NULL, NULL, dirname(__FILE__).'/mails/');    }                   $R157A6826A8BF1F36EBBE3DEC02351744 = new AgileSellerMessage($R2065A4598F5AC52A855CD972A4D582B5->id);       $R157A6826A8BF1F36EBBE3DEC02351744->id = 0;      $R157A6826A8BF1F36EBBE3DEC02351744->is_customer_message = 0;      $R157A6826A8BF1F36EBBE3DEC02351744->ip_address = $_SERVER['REMOTE_ADDR'];       $R157A6826A8BF1F36EBBE3DEC02351744->from_email = $R224ED324F2BC1D54C39C9EA8DBC1FDCE;            $R157A6826A8BF1F36EBBE3DEC02351744->from_name = $RB1F893EC40EFE964D900B41AF7FCC4AB;            $R157A6826A8BF1F36EBBE3DEC02351744->message = $R6F82286AF8E7368B69D53D2BFC9EECFA;       if(intval(Configuration::get('ASMGER_APPROVAL_REQUIRED')))        $R157A6826A8BF1F36EBBE3DEC02351744->active = 0;       else        $R157A6826A8BF1F36EBBE3DEC02351744->active = 1;       $R157A6826A8BF1F36EBBE3DEC02351744->message = $R6F82286AF8E7368B69D53D2BFC9EECFA;                  $R157A6826A8BF1F36EBBE3DEC02351744->save();                         return $RA82B8E922943C74082F982E24398CA04;          }             public static function activate_message_front($R863179D6E500EBCBEB79B706E874236B, $R971D98E0AD23E0905A3D3F4B08D46579)      {      $RB10E8575D7A5B4C417D9DCF8D6BC17BE = Context::getContext();         if(!$RB10E8575D7A5B4C417D9DCF8D6BC17BE->customer->isLogged()) return Tools::displayError("You must be logged in to perform this action");          $R863179D6E500EBCBEB79B706E874236B = intval(Tools::getValue('id_agile_sellermessage'));          if($R863179D6E500EBCBEB79B706E874236B<=0)  return Tools::displayError("Invalid parameter");            include_once(_PS_ROOT_DIR_ . "/modules/agilemultipleseller/SellerInfo.php");          include_once(_PS_ROOT_DIR_ . "/modules/agilesellermessenger/AgileSellerMessage.php");            $R157A6826A8BF1F36EBBE3DEC02351744 = new AgileSellerMessage($R863179D6E500EBCBEB79B706E874236B);          if(!Validate::isLoadedObject($R157A6826A8BF1F36EBBE3DEC02351744)) return Tools::displayError("Message not found");              $R95909C49377A2B4F24C79D29C629AF65 = AgileSellerManager::getLinkedSellerID($RB10E8575D7A5B4C417D9DCF8D6BC17BE->cookie->id_customer);          if($R95909C49377A2B4F24C79D29C629AF65 != $R157A6826A8BF1F36EBBE3DEC02351744->id_seller)return Tools::displayError("You do not have permission");          $R130D64A4AD653C91E0FD80DE8FEADC3A = 'UPDATE ' .  _DB_PREFIX_ .'agile_sellermessage SET active=' . $R971D98E0AD23E0905A3D3F4B08D46579 . ' WHERE id_agile_sellermessage=' . $R863179D6E500EBCBEB79B706E874236B;          Db::getInstance()->Execute($R130D64A4AD653C91E0FD80DE8FEADC3A);          return '';      }      public static function openUploadedFile($R95909C49377A2B4F24C79D29C629AF65, $R3656889A448A7AF799D2D7955BED2354)   {    $RFCE3AB8058767399F7BB20A006DF074F = array('.txt' => 'text/plain', '.rtf' => 'application/rtf', '.doc' => 'application/msword', '.docx'=> 'application/msword',     '.pdf' => 'application/pdf', '.zip' => 'multipart/x-zip', '.png' => 'image/png', '.jpeg' => 'image/jpeg', '.gif' => 'image/gif', '.jpg' => 'image/jpeg');      $R33D3EC748433467E20D0947C3032E305 = '';    foreach ($RFCE3AB8058767399F7BB20A006DF074F AS $RF413F06AEBBCEF5E1C8B1019DEE6FE6B => $R244F38266C59587D696AEC08A771B803)    {     if (substr($R3656889A448A7AF799D2D7955BED2354, -4) == $RF413F06AEBBCEF5E1C8B1019DEE6FE6B OR substr($R3656889A448A7AF799D2D7955BED2354, -5) == $RF413F06AEBBCEF5E1C8B1019DEE6FE6B)     {      $R33D3EC748433467E20D0947C3032E305 = $R244F38266C59587D696AEC08A771B803;      break;     }    }      $R3435986BDA8C9393E0EBDB9F58F02750 = AgileSellerMessenger::prepareAttFolder(intval($R95909C49377A2B4F24C79D29C629AF65));    ob_end_clean();    header('Content-Type: '.$R33D3EC748433467E20D0947C3032E305);    header('Content-Disposition:attachment;filename="'.$R3656889A448A7AF799D2D7955BED2354.'"');    readfile($R3435986BDA8C9393E0EBDB9F58F02750.$R3656889A448A7AF799D2D7955BED2354);        die;   }          }    